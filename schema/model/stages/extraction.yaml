id: https://open-and-sustainable.github.io/revaise-model/schema/stages/extraction
name: extraction_stage
description: "Schema for data extraction stage of the review workflow."
prefixes:
    linkml: https://w3id.org/linkml/
    revaise: https://open-and-sustainable.github.io/revaise-model/schema/
default_prefix: revaise
imports:
    - linkml:types
    - ../review_core
    - ../objects/literature_record
    - ../objects/author
    - ../objects/registration_template
    - ../objects/participant
    - ../objects/ai_assistance
    - ../objects/quality_metrics
    - ../objects/conflict_resolution
    - ../objects/work_session
    - ../objects/field_definition
    - ../objects/quality_assessment

classes:
    ExtractionStage:
        is_a: StageExecution
        description: "Data extraction from included studies."
        slots:
            - extraction_forms
            - extraction_protocol
            - extracted_studies
            - extraction_quality_control
            - extraction_statistics
            - ai_assistance_config
        slot_usage:
            extraction_forms:
                range: ExtractionForm
                multivalued: true
                description: "Data extraction forms/templates used"
            extraction_protocol:
                range: ExtractionProtocol
                required: true
                description: "Protocol for data extraction process"
            extracted_studies:
                range: ExtractedStudy
                multivalued: true
                description: "Studies with extracted data"
            extraction_quality_control:
                range: ExtractionQualityControl
                description: "Quality control measures for extraction"
            extraction_statistics:
                range: ExtractionStatistics
                description: "Overall statistics for the extraction stage"
            ai_assistance_config:
                range: AIAssistance
                description: "AI assistance configuration for extraction"

    ExtractionForm:
        description: "Template or form used for data extraction"
        slots:
            - form_id
            - form_name
            - form_version
            - form_description
            - form_sections
            - form_uri
            - pilot_tested
            - pilot_test_date
            - pilot_test_notes
            - form_created_by
            - form_created_at
            - form_last_modified
        slot_usage:
            form_id:
                range: string
                identifier: true
                description: "Unique identifier for the form"
            form_name:
                range: string
                required: true
                description: "Name of the extraction form"
            form_version:
                range: string
                required: true
                description: "Version of the form"
            form_description:
                range: string
                description: "Description of what the form captures"
            form_sections:
                range: FormSection
                multivalued: true
                description: "Sections within the form"
            form_uri:
                range: uri
                description: "URI to the form template"
            pilot_tested:
                range: boolean
                description: "Whether the form was pilot tested"
            pilot_test_date:
                range: date
                description: "Date of pilot testing"
            pilot_test_notes:
                range: string
                description: "Notes from pilot testing"
            form_created_by:
                range: Author
                description: "Creator of the form"
            form_created_at:
                range: datetime
                description: "Creation timestamp"
            form_last_modified:
                range: datetime
                description: "Last modification timestamp"

    ExtractionProtocol:
        description: "Protocol for the data extraction process"
        slots:
            - minimum_extractors_per_study
            - independent_extraction
            - disagreement_resolution_method
            - extraction_order
            - blinding_level
            - extraction_tools
            - extraction_software
            - training_materials_uri
            - extraction_guidance
        slot_usage:
            protocol_id:
                range: string
                identifier: true
                description: "Unique identifier for the extraction protocol"
            minimum_extractors_per_study:
                range: integer
                required: true
                description: "Minimum number of extractors per study"
            independent_extraction:
                range: boolean
                description: "Whether extraction is done independently"
            disagreement_resolution_method:
                range: ResolutionMethod
                description: "Method for resolving extraction disagreements"
            extraction_order:
                range: ExtractionOrder
                description: "Order in which studies are extracted"
            blinding_level:
                range: BlindingLevel
                description: "Level of blinding during extraction"
            extraction_tools:
                range: ExternalTool
                multivalued: true
                description: "AI-assisted extraction tools/platforms used"
            extraction_software:
                range: ExternalTool
                multivalued: true
                description: "Software tools used for extraction"
            training_materials_uri:
                range: uri
                description: "URI to training materials for extractors"
            extraction_guidance:
                range: string
                description: "Detailed guidance for extractors"
            protocol_notes:
                range: string
                description: "Additional protocol notes"

    ExtractedStudy:
        description: "A study with extracted data"
        slots:
            - extracted_study_id
            - source_record_id
            - extraction_form_id
            - extracted_data
            - extraction_sessions
            - extraction_status
            - extraction_notes
            - study_characteristics
            - quality_assessment
            - final_extracted_values
            - ai_extraction_session
        slot_usage:
            extracted_study_id:
                range: string
                identifier: true
                description: "Unique identifier for the extracted study"
            source_record_id:
                range: string
                required: true
                description: "Reference to the source literature record"
            extraction_form_id:
                range: string
                required: true
                description: "Reference to the extraction form used"
            extracted_data:
                range: ExtractedDataPoint
                multivalued: true
                description: "Individual data points extracted"
            extraction_sessions:
                range: WorkSession
                multivalued: true
                description: "Work sessions for this extraction"
            extraction_status:
                range: ExtractionStatus
                required: true
                description: "Current status of extraction"
            extraction_notes:
                range: string
                description: "Notes about the extraction"
            study_characteristics:
                range: StudyCharacteristics
                description: "Key characteristics of the study"
            quality_assessment:
                range: QualityAssessment
                description: "Quality/risk of bias assessment"
            final_extracted_values:
                range: ExtractedDataPoint
                multivalued: true
                description: "Final reconciled values after resolution"
            ai_extraction_session:
                range: AISession
                description: "AI-specific extraction session details"

    ExtractedDataPoint:
        description: "Individual data point extracted from a study"
        slots:
            - datapoint_id
            - extracted_value
            - extracted_unit
            - extraction_confidence
            - page_number
            - quote
            - extractor_notes
            - extraction_timestamp
            - extractor_id
            - ai_assisted
            - ai_confidence
        slot_usage:
            datapoint_id:
                range: string
                identifier: true
                description: "Unique identifier for this data point"
            field_id:
                range: string
                required: true
                description: "Reference to the field definition"
            extracted_value:
                range: string
                required: true
                description: "The extracted value"
            extracted_unit:
                range: string
                description: "Unit of measurement if applicable"
            extraction_confidence:
                range: ConfidenceLevel
                description: "Confidence in the extraction"
            page_number:
                range: string
                description: "Page number(s) where data was found"
            quote:
                range: string
                description: "Direct quote from the source"
            extractor_notes:
                range: string
                description: "Notes from the extractor"
            extraction_timestamp:
                range: datetime
                required: true
                description: "When extraction occurred"
            extractor_id:
                range: string
                required: true
                description: "ID of the extractor (human or AI)"
            ai_assisted:
                range: boolean
                description: "Whether AI assisted in extraction"
            ai_confidence:
                range: float
                description: "AI confidence score if applicable"

    ExtractionQualityControl:
        description: "Quality control measures for data extraction"
        slots:
            - extraction_qc_id
            - double_extraction_rate
            - agreement_metrics
            - discrepancy_resolutions
            - spot_check_rate
            - spot_check_results
            - training_provided
            - calibration_exercises
            - qc_notes
        slot_usage:
            extraction_qc_id:
                range: string
                identifier: true
                description: "Unique identifier for quality control record"
            double_extraction_rate:
                range: float
                description: "Percentage of studies double-extracted"
            agreement_metrics:
                range: AgreementMetrics
                description: "Inter-rater agreement statistics"
            discrepancy_resolutions:
                range: ConflictResolution
                multivalued: true
                description: "Records of resolved discrepancies"
            spot_check_rate:
                range: float
                description: "Percentage of extractions spot-checked"
            spot_check_results:
                range: string
                description: "Results of spot checks"
            training_provided:
                range: boolean
                description: "Whether training was provided"
            calibration_exercises:
                range: string
                description: "Description of calibration exercises"
            qc_notes:
                range: string
                description: "Additional quality control notes"

    ExtractionStatistics:
        description: "Overall statistics for the extraction stage"
        slots:
            - total_studies_extracted
            - total_data_points
            - extraction_completion_rate
            - average_time_per_study
            - total_extraction_hours
            - participant_workloads
            - missing_data_rate
            - extraction_started_date
            - extraction_completed_date
        slot_usage:
            total_studies_extracted:
                range: integer
                required: true
                description: "Total number of studies extracted"
            total_data_points:
                range: integer
                description: "Total number of data points extracted"
            extraction_completion_rate:
                range: float
                description: "Percentage of planned extractions completed"
            average_time_per_study:
                range: float
                description: "Average time per study in hours"
            total_extraction_hours:
                range: float
                description: "Total hours spent on extraction"
            participant_workloads:
                range: ParticipantWorkload
                multivalued: true
                description: "Workload statistics per participant"
            missing_data_rate:
                range: float
                description: "Rate of missing data across extractions"
            extraction_started_date:
                range: date
                description: "Date extraction began"
            extraction_completed_date:
                range: date
                description: "Date extraction completed"

slots:
    # Stage-level slots
    ai_assistance_config:
        description: "AI assistance configuration for extraction"
        range: AIAssistance
    extraction_forms:
        description: "Data extraction forms used"
        range: ExtractionForm
    extraction_protocol:
        description: "Protocol for data extraction"
        range: ExtractionProtocol
    extracted_studies:
        description: "Studies with extracted data"
        range: ExtractedStudy
    extraction_quality_control:
        description: "Quality control for extraction"
        range: ExtractionQualityControl
    extraction_statistics:
        description: "Statistics for extraction stage"
        range: ExtractionStatistics

    # Form-related slots
    form_id:
        description: "Form identifier"
        range: string
    form_name:
        description: "Form name"
        range: string
    form_version:
        description: "Form version"
        range: string
    form_description:
        description: "Form description"
        range: string
    form_sections:
        description: "Sections in form"
        range: FormSection
    form_uri:
        description: "URI to form"
        range: uri
    pilot_tested:
        description: "Whether pilot tested"
        range: boolean
    pilot_test_date:
        description: "Date of pilot test"
        range: date
    pilot_test_notes:
        description: "Pilot test notes"
        range: string
    form_created_by:
        description: "Form creator"
        range: Author
    form_created_at:
        description: "Form creation time"
        range: datetime
    form_last_modified:
        description: "Last modification time"
        range: datetime

    # Protocol slots
    minimum_extractors_per_study:
        description: "Minimum number of extractors per study"
        range: integer
    independent_extraction:
        description: "Whether extraction is independent"
        range: boolean
    disagreement_resolution_method:
        description: "Method for resolving disagreements"
        range: ResolutionMethod
    extraction_order:
        description: "Order of extraction"
        range: ExtractionOrder
    extraction_tools:
        description: "AI-assisted extraction tools used"
        range: ExternalTool
    blinding_level:
        description: "Level of blinding"
        range: BlindingLevel
    extraction_software:
        description: "Software used for extraction"
        range: ExternalTool
    training_materials_uri:
        description: "URI to training materials"
        range: uri
    extraction_guidance:
        description: "Guidance for extractors"
        range: string

    # Study-related slots
    extracted_study_id:
        description: "Unique identifier for extracted study"
        range: string
    source_record_id:
        description: "Reference to source record"
        range: string
    extraction_form_id:
        description: "Reference to extraction form"
        range: string
    extracted_data:
        description: "Extracted data points"
        range: ExtractedDataPoint
    extraction_sessions:
        description: "Extraction work sessions"
        range: WorkSession
    extraction_status:
        description: "Status of extraction"
        range: ExtractionStatus
    extraction_notes:
        description: "Notes about extraction"
        range: string
    study_characteristics:
        description: "Key characteristics of the study"
        range: StudyCharacteristics
    quality_assessment:
        description: "Quality/risk of bias assessment"
        range: QualityAssessment
    final_extracted_values:
        description: "Final extracted values"
        range: ExtractedDataPoint
    ai_extraction_session:
        description: "AI extraction session"
        range: AISession

    # Data point slots
    datapoint_id:
        description: "Data point identifier"
        range: string
    extracted_value:
        description: "Extracted value"
        range: string
    extracted_unit:
        description: "Unit of measurement"
        range: string
    extraction_confidence:
        description: "Confidence in extraction"
        range: ConfidenceLevel
    page_number:
        description: "Page number"
        range: string
    quote:
        description: "Supporting quote"
        range: string
    extractor_notes:
        description: "Extractor notes"
        range: string
    extraction_timestamp:
        description: "When extracted"
        range: datetime
    extractor_id:
        description: "ID of extractor"
        range: string
    ai_assisted:
        description: "Whether AI assisted"
        range: boolean
    ai_confidence:
        description: "AI confidence score"
        range: float

    # QC slots
    extraction_qc_id:
        description: "QC record identifier"
        range: string
    double_extraction_rate:
        description: "Rate of double extraction"
        range: float
    agreement_metrics:
        description: "Agreement statistics"
        range: AgreementMetrics
    discrepancy_resolutions:
        description: "Resolved discrepancies"
        range: ConflictResolution
    spot_check_rate:
        description: "Rate of spot checks"
        range: float
    spot_check_results:
        description: "Results of spot checks"
        range: string
    training_provided:
        description: "Whether training provided"
        range: boolean
    calibration_exercises:
        description: "Calibration exercises performed"
        range: string
    qc_notes:
        description: "QC notes"
        range: string

    # Statistics slots
    total_studies_extracted:
        description: "Total studies extracted"
        range: integer
    total_data_points:
        description: "Total data points"
        range: integer
    extraction_completion_rate:
        description: "Completion rate"
        range: float
    average_time_per_study:
        description: "Average time per study"
        range: float
    total_extraction_hours:
        description: "Total extraction hours"
        range: float
    participant_workloads:
        description: "Workload per participant"
        range: ParticipantWorkload
    missing_data_rate:
        description: "Rate of missing data"
        range: float
    extraction_started_date:
        description: "Start date"
        range: date
    extraction_completed_date:
        description: "Completion date"
        range: date

enums:
    ExtractionStatus:
        description: "Status of data extraction"
        permissible_values:
            NOT_STARTED:
                description: "Extraction not yet started"
            IN_PROGRESS:
                description: "Extraction in progress"
            COMPLETED:
                description: "Extraction completed"
            REQUIRES_REVIEW:
                description: "Extraction requires review"
            DISCREPANCY_RESOLUTION:
                description: "Resolving discrepancies"
            FINALIZED:
                description: "Extraction finalized"
            EXCLUDED:
                description: "Study excluded during extraction"

    ExtractionOrder:
        description: "Order for extracting studies"
        permissible_values:
            RANDOM:
                description: "Random order"
            ALPHABETICAL:
                description: "Alphabetical by title or author"
            CHRONOLOGICAL:
                description: "By publication date"
            BY_RELEVANCE:
                description: "By relevance score"
            BY_QUALITY:
                description: "By quality rating"
            ASSIGNED:
                description: "Pre-assigned order"

    BlindingLevel:
        description: "Level of blinding in extraction"
        permissible_values:
            NONE:
                description: "No blinding"
            SINGLE_BLIND:
                description: "Extractors blind to some information"
            DOUBLE_BLIND:
                description: "Extractors blind to each other's extractions"
            TRIPLE_BLIND:
                description: "Additional blinding measures"
