id: https://open-and-sustainable.github.io/revaise-model/schema/profiles/review_full
name: review_full
description: "Complete review profile with all required and recommended fields for a full systematic review."
prefixes:
    linkml: https://w3id.org/linkml/
    revaise: https://open-and-sustainable.github.io/revaise-model/schema/
default_prefix: revaise
imports:
    - ../core
    - ../stages/search
    - ../stages/screening
    - ../stages/data_extraction

# Full review profile for complete systematic reviews
classes:
    Review:
        slot_usage:
            review_id:
                required: true
                pattern: "^[A-Za-z0-9_\\-]+$"
                description: "Unique identifier for the review"
            title:
                required: true
                min_length: 10
                max_length: 500
                description: "Descriptive title of the systematic review"
            review_type:
                required: true
                description: "Type of review being conducted"
            abstract:
                recommended: true
                min_length: 100
                max_length: 5000
                description: "Structured or unstructured abstract"
            keywords:
                recommended: true
                minimum_cardinality: 3
                maximum_cardinality: 10
                description: "Keywords for indexing and discovery"
            protocol:
                required: true
                description: "Review protocol is mandatory for systematic reviews"
            authors:
                required: true
                minimum_cardinality: 2
                description: "At least two authors required for systematic reviews"
            corresponding_author:
                required: true
                description: "Corresponding author must be specified"
            review_status:
                required: true
                description: "Current status of the review"
            version:
                recommended: true
                pattern: "^\\d+\\.\\d+\\.\\d+$"
                description: "Semantic versioning recommended (e.g., 1.0.0)"
            start_date:
                required: true
                description: "Review start date must be documented"
            created_at:
                required: true
                description: "Record creation timestamp"
            updated_at:
                required: true
                description: "Last update timestamp"
            funding_sources:
                recommended: true
                description: "Funding should be declared"
            conflicts_of_interest:
                required: true
                description: "Conflicts of interest must be declared"
            stages:
                required: true
                minimum_cardinality: 1
                description: "At least one stage must be documented"
            literature_records:
                required: true
                description: "Literature records must be maintained"
            software_env:
                recommended: true
                description: "Software environment for reproducibility"

    Author:
        slot_usage:
            name:
                required: true
                min_length: 2
                description: "Full name of the author"
            orcid:
                recommended: true
                pattern: "^\\d{4}-\\d{4}-\\d{4}-\\d{3}[\\dX]$"
                description: "ORCID strongly recommended for author disambiguation"
            email:
                recommended: true
                pattern: "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$"
                description: "Valid email address"
            affiliations:
                recommended: true
                minimum_cardinality: 1
                description: "At least one affiliation recommended"

    Affiliation:
        slot_usage:
            institution_name:
                required: true
                min_length: 2
                description: "Name of the institution"
            country:
                recommended: true
                description: "Country recommended for geographic diversity tracking"
            ror_id:
                recommended: true
                pattern: "^https://ror.org/0[a-z0-9]{8}$"
                description: "ROR ID recommended for institution disambiguation"

    Protocol:
        slot_usage:
            registry:
                required: true
                description: "Registry name (e.g., PROSPERO, OSF)"
            registration_id:
                required: true
                description: "Registration identifier"
            registration_url:
                recommended: true
                pattern: "^https?://.+"
                description: "Direct URL to registration"
            research_question:
                required: true
                min_length: 10
                description: "Clear research question"
            eligibility_criteria:
                required: true
                description: "Inclusion and exclusion criteria"
            picos:
                recommended: true
                description: "PICOS framework recommended"
            start_date:
                required: true
                description: "Protocol start date"

    FundingSource:
        slot_usage:
            funder_name:
                required: true
                description: "Name of funding organization"
            grant_number:
                recommended: true
                description: "Grant number if applicable"

    LiteratureRecord:
        slot_usage:
            record_id:
                required: true
                pattern: "^[A-Za-z0-9_\\-]+$"
                description: "Unique identifier for the record"
            title:
                required: true
                min_length: 1
                description: "Publication title"
            authors:
                required: true
                minimum_cardinality: 1
                description: "At least one author"
            publication_year:
                recommended: true
                minimum_value: 1900
                maximum_value: 2100
                description: "Valid publication year"
            abstract:
                recommended: true
                description: "Abstract for screening"
            doi:
                recommended: true
                pattern: "^10\\.\\d{4,}/.+$"
                description: "DOI when available"

    LiteratureRecordCollection:
        slot_usage:
            collection_id:
                required: true
                pattern: "^[A-Za-z0-9_\\-]+$"
                description: "Unique collection identifier"
            collection_name:
                required: true
                min_length: 1
                description: "Descriptive collection name"
            records:
                required: true
                minimum_cardinality: 0
                description: "Collection may be empty initially"
            record_count:
                required: true
                minimum_value: 0
                description: "Count of records"

    StageExecution:
        slot_usage:
            stage_type:
                required: true
                description: "Type of stage"
            label:
                recommended: true
                description: "Human-readable label"
            started_at:
                required: true
                description: "Stage start time"
            ended_at:
                recommended: true
                description: "Stage end time"

    Artifact:
        slot_usage:
            kind:
                required: true
                description: "Type of artifact"
            resource_uri:
                required: true
                pattern: "^(file://|https?://|s3://|gs://).+"
                description: "Valid URI to resource"
            format:
                recommended: true
                description: "File format or MIME type"
            checksum:
                recommended: true
                pattern: "^(md5|sha1|sha256|sha512):[a-f0-9]+$"
                description: "Checksum for verification"
            created_at:
                required: true
                description: "Creation timestamp"

    SoftwareEnv:
        slot_usage:
            os:
                recommended: true
                description: "Operating system"
            containers:
                recommended: true
                description: "Container images used"
            lockfiles:
                recommended: true
                description: "Dependency lockfiles"

# Validation rules for data consistency
validation:
    rules:
        - description: "Review must have at least one search stage"
          sparql: |
              PREFIX revaise: <https://open-and-sustainable.github.io/revaise-model/schema/>
              SELECT ?review WHERE {
                  ?review a revaise:Review .
                  FILTER NOT EXISTS {
                      ?review revaise:stages ?stage .
                      ?stage revaise:stage_type "search" .
                  }
              }

        - description: "Corresponding author must be in authors list"
          sparql: |
              PREFIX revaise: <https://open-and-sustainable.github.io/revaise-model/schema/>
              SELECT ?review ?corresponding WHERE {
                  ?review a revaise:Review ;
                          revaise:corresponding_author ?corresponding .
                  FILTER NOT EXISTS {
                      ?review revaise:authors ?corresponding .
                  }
              }

        - description: "Completed reviews must have completion date"
          sparql: |
              PREFIX revaise: <https://open-and-sustainable.github.io/revaise-model/schema/>
              SELECT ?review WHERE {
                  ?review a revaise:Review ;
                          revaise:review_status "COMPLETED" .
                  FILTER NOT EXISTS {
                      ?review revaise:completion_date ?date .
                  }
              }
